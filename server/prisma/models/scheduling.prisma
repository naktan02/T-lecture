enum AssignmentCategory {
  Temporary
  Confirmed

  @@map("배치분류__t")
}

enum AssignmentState {
  Pending // 임시 배정 (응답 대기)
  Accepted // 수락됨 (확정)
  Rejected // 거절됨
  Canceled // 관리자 취소

  @@map("배정상태__t")
}

enum AssignmentRole {
  Head       // 총괄강사 (주강사 1명일 때)
  Supervisor // 책임강사 (주강사 2명+ 중 팀장/선임)

  @@map("배정역할__t")
}

model InstructorAvailability {
  id           Int      @id @default(autoincrement())
  instructorId Int      @map("강사id")
  availableOn  DateTime @map("가능일") @db.Date

  instructor Instructor @relation(fields: [instructorId], references: [userId])

  @@unique([instructorId, availableOn], map: "강사가능일_instructor_date_unique")
  @@index([instructorId], map: "강사가능일_instructor_idx")
  @@map("강사가능일")
}

model InstructorUnitAssignment {
  userId             Int
  unitScheduleId     Int
  trainingLocationId Int?                @map("교육장id")
  classification     AssignmentCategory? @map("배치분류")
  state              AssignmentState     @default(Pending) @map("배정상태")
  role               AssignmentRole?     @map("배정역할")

  User             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  UnitSchedule     UnitSchedule      @relation(fields: [unitScheduleId], references: [id], onDelete: Cascade)
  TrainingLocation TrainingLocation? @relation(fields: [trainingLocationId], references: [id], onDelete: Cascade)

  dispatchAssignments DispatchAssignment[]

  @@id([unitScheduleId, userId])
  @@unique([unitScheduleId, userId], name: "assignment_instructor_schedule_unique")
  @@map("강사_부대_배정")
}

model InstructorUnitDistance {
  userId   Int
  unitId   Int      @map("부대id")
  distance Decimal? @map("거리")
  duration Int?     @map("걸리는시간")

  instructor Instructor @relation(fields: [userId], references: [userId], onDelete: Cascade)
  unit       Unit       @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@id([userId, unitId])
  @@map("강사-부대 거리")
}

// 우선배정 크레딧 (부대 사정으로 취소된 강사에게 우선권 부여)
model InstructorPriorityCredit {
  id           Int      @id @default(autoincrement())
  instructorId Int      @unique @map("강사id")
  credits      Int      @default(1) @map("우선배정크레딧")
  reasons      Json?    @map("사유목록") // [{"unit": "부대명", "date": "YYYY-MM-DD", "type": "변경"}]
  createdAt    DateTime @default(now()) @map("생성일시")
  updatedAt    DateTime @updatedAt @map("수정일시")

  instructor Instructor @relation(fields: [instructorId], references: [userId], onDelete: Cascade)

  @@map("강사우선배정크레딧")
}

// 시스템 설정 (가중치, 설정값 등)
model SystemConfig {
  id          Int     @id @default(autoincrement())
  key         String  @unique @map("설정키")
  value       String  @map("설정값") @db.Text
  description String? @map("설명")

  @@map("시스템설정")
}

// 강사 패널티 (거절 시 패널티 기간 누적)
model InstructorPenalty {
  id         Int      @id @default(autoincrement())
  userId     Int      @unique @map("강사id")
  count      Int      @default(1) @map("누적횟수")
  expiresAt  DateTime @map("만료일")
  reasons    Json?    @map("사유목록") // [{"unit": "부대명", "date": "YYYY-MM-DD", "type": "거절"}]
  createdAt  DateTime @default(now()) @map("생성일시")
  updatedAt  DateTime @updatedAt @map("수정일시")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("강사패널티")
}

