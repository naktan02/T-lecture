enum UserCategory {
  Main
  Co
  Assistant
  Practicum

  @@map("분류__t")
}

enum AdminLevel {
  GENERAL // 일반 관리자
  SUPER // 슈퍼 관리자
}

enum UserStatus {
  PENDING // 승인 대기
  APPROVED // 승인 완료 (활동 증)
  RESTING // 휴식 중 (배정 X)
  INACTIVE // 탈퇴/정지
}

model User {
  id              Int        @id @default(autoincrement())
  userEmail       String?    @unique @map("user_email")
  password        String?
  name            String?
  userphoneNumber String?    @map("userphoneNumber")
  status          UserStatus @default(PENDING)

  // Relations
  instructor      Instructor?
  admin           Admin?
  messageReceipts MessageReceipt[]
  unitAssignments InstructorUnitAssignment[]
  refreshTokens   RefreshToken[]
  notices         Notice[]

  @@map("user")
}

model Admin {
  id     Int        @id @default(autoincrement())
  userId Int        @unique @map("user_id")
  level  AdminLevel @default(GENERAL)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("admins")
}

model Instructor {
  userId           Int           @id @map("user_id")
  category         UserCategory? @map("분류")
  teamId           Int?          @map("team_id")
  isTeamLeader     Boolean       @default(false) @map("팀장여부")
  location         String?       @db.Text
  generation       Int?          @map("기수") @db.SmallInt
  restrictedArea   String?       @map("제한지역") @db.Text
  lat              Float?        @map("위도")
  lng              Float?        @map("경도")
  hasCar           Boolean       @default(false) @map("자차여부")
  profileCompleted Boolean       @default(false) @map("강사프로필완료")

  // relations
  user User  @relation(fields: [userId], references: [id])
  team Team? @relation(fields: [teamId], references: [id])

  availabilities  InstructorAvailability[]
  virtues         InstructorVirtue[]
  distances       InstructorUnitDistance[]
  instructorStats InstructorStats[]

  @@map("강사")
}

model Team {
  id        Int       @id @default(autoincrement())
  name      String?   @map("team_name")
  deletedAt DateTime? @map("deleted_at")

  instructors Instructor[]

  @@map("team")
}

model Virtue {
  id   Int     @id @default(autoincrement())
  name String? @map("덕목")

  instructorVirtues InstructorVirtue[]

  @@map("덕목")
}

model InstructorVirtue {
  instructorId Int @map("강사id")
  virtueId     Int @map("덕목id")

  instructor Instructor @relation(fields: [instructorId], references: [userId])
  virtue     Virtue     @relation(fields: [virtueId], references: [id], onDelete: Cascade)

  @@id([instructorId, virtueId]) // 동일 (강사,덕목) 중복 방지
  @@map("강사가능덕목")
}

model InstructorStats {
  instructorId         Int     @id @map("instructor_id")
  legacyPracticumCount Int     @default(0) @map("legacy_practicum_count")
  autoPromotionEnabled Boolean @default(true) @map("auto_promotion_enabled")

  // Relations
  instructor Instructor @relation(fields: [instructorId], references: [userId])

  @@map("instructor_stats")
}
