enum MessageType {

  Temporary
  Confirmed
  Notice     // 공지사항 타입 추가

  @@map("유형__t")
}

// 메시지 상태 (예: 발송대기, 발송완료, 취소 등)
enum MessageStatus {
  Pending
  Sent
  Canceled

  @@map("상태__t")
}

model Message {
  id        Int            @id @default(autoincrement())
  type      MessageType?   @map("유형")
  title     String?        @map("제목")
  body      String?        @map("본문") @db.Text
  status    MessageStatus? @map("상태")
  createdAt DateTime?      @default(now()) @map("생성일시")

  // 공지사항 전용 필드
  authorId  Int?           @map("작성자id")
  viewCount Int            @default(0) @map("조회수")
  isPinned  Boolean        @default(false) @map("상단고정")
  updatedAt DateTime?      @updatedAt @map("수정일시")

  // 관계
  assignments MessageAssignment[]
  receipts    MessageReceipt[]

  @@map("메시지")
}

model MessageReceipt {
  messageId Int       @map("메시지id")
  userId    Int       @map("강사id")
  readAt    DateTime? @map("read_at")

  message Message @relation(fields: [messageId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  @@id([userId, messageId])
  @@index([userId], map: "메시지수신_user_idx")
  @@map("메시지 수신자")
}

model MessageAssignment {
  messageId      Int
  unitScheduleId Int
  userId         Int

  message    Message                  @relation(fields: [messageId], references: [id])
  assignment InstructorUnitAssignment @relation(fields: [unitScheduleId, userId], references: [unitScheduleId, userId])

  @@id([messageId, unitScheduleId, userId])
  @@map("메시지_배정")
}

model MessageTemplate {
  key       String   @id @map("템플릿키") // 예: "TEMPORARY", "CONFIRMED_LEADER", "CONFIRMED_MEMBER"
  title     String   @map("제목")
  body      String   @map("본문") @db.Text // 긴 글 저장을 위해 Text 타입
  updatedAt DateTime @updatedAt @map("수정일시")

  @@map("메시지_템플릿")
}

