enum MessageType {
  Temporary
  Confirmed

  @@map("유형__t")
}

// 메시지 상태 (예: 발송대기, 발송완료, 취소 등)
enum MessageStatus {
  Pending
  Sent
  Canceled

  @@map("상태__t")
}

// 배정 메시지 전용 모델 (임시/확정 배정)
model Message {
  id        Int            @id @default(autoincrement())
  type      MessageType?   @map("유형")
  title     String?        @map("제목")
  body      String?        @map("본문") @db.Text
  status    MessageStatus? @map("상태")
  createdAt DateTime?      @default(now()) @map("생성일시")

  // 관계
  assignments MessageAssignment[]
  receipts    MessageReceipt[]

  @@map("메시지")
}

model MessageReceipt {
  messageId Int       @map("메시지id")
  userId    Int       @map("강사id")
  readAt    DateTime? @map("read_at")

  message Message @relation(fields: [messageId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  @@id([userId, messageId])
  @@index([userId], map: "메시지수신_user_idx")
  @@map("메시지 수신자")
}

model MessageAssignment {
  messageId      Int
  unitScheduleId Int
  userId         Int

  message    Message                  @relation(fields: [messageId], references: [id])
  assignment InstructorUnitAssignment @relation(fields: [unitScheduleId, userId], references: [unitScheduleId, userId])

  @@id([messageId, unitScheduleId, userId])
  @@map("메시지_배정")
}

model MessageTemplate {
  key           String   @id @map("템플릿키")
  title         String   @map("제목")
  body          Json     @map("본문") @db.JsonB
  formatPresets Json?    @map("포맷프리셋") @db.JsonB
  updatedAt     DateTime @updatedAt @map("수정일시")

  @@map("메시지_템플릿")
}

// ==========================================
// 공지사항
// ==========================================

model Notice {
  id        Int       @id @default(autoincrement())
  title     String    @map("제목")
  body      String    @map("본문") @db.Text
  authorId  Int       @map("작성자id")
  viewCount Int       @default(0) @map("조회수")
  isPinned  Boolean   @default(false) @map("상단고정")
  createdAt DateTime  @default(now()) @map("생성일시")
  updatedAt DateTime  @updatedAt @map("수정일시")

  // 관계
  author   User            @relation("NoticeAuthor", fields: [authorId], references: [id])
  receipts NoticeReceipt[]

  @@map("공지사항")
}

model NoticeReceipt {
  noticeId Int       @map("공지id")
  userId   Int       @map("수신자id")
  readAt   DateTime? @map("읽은일시")

  notice Notice @relation(fields: [noticeId], references: [id], onDelete: Cascade)
  user   User   @relation("NoticeRecipient", fields: [userId], references: [id])

  @@id([noticeId, userId])
  @@index([userId])
  @@map("공지수신자")
}

// ==========================================
// 문의사항
// ==========================================

enum InquiryStatus {
  Waiting  // 답변 대기
  Answered // 답변 완료

  @@map("문의상태__t")
}

model Inquiry {
  id         Int           @id @default(autoincrement())
  title      String        @map("제목")
  body       String        @map("본문") @db.Text
  authorId   Int           @map("작성자id")
  status     InquiryStatus @default(Waiting) @map("상태")
  answer     String?       @map("답변") @db.Text
  answeredBy Int?          @map("답변자id")
  answeredAt DateTime?     @map("답변일시")
  createdAt  DateTime      @default(now()) @map("생성일시")

  // 관계
  author         User  @relation("InquiryAuthor", fields: [authorId], references: [id])
  answeredByUser User? @relation("InquiryAnswerer", fields: [answeredBy], references: [id])

  @@map("문의사항")
}
