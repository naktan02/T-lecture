enum MessageType {
  Notice
  Temporary
  Confirmed

  @@map("유형__t")
}

// 메시지 상태 (예: 발송대기, 발송완료, 취소 등)
enum MessageStatus {
  Pending
  Sent
  Canceled

  @@map("상태__t")
}

model Message {
  id        Int            @id @default(autoincrement())
  type      MessageType?   @map("유형")
  title     String?        @map("제목")
  body      String?        @map("본문")
  status    MessageStatus? @map("상태")
  createdAt DateTime?      @map("생성일시")

  assignments MessageAssignment[]
  receipts    MessageReceipt[]

  @@map("메시지")
}

model MessageReceipt {
  messageId Int       @map("메시지id")
  userId    Int       @map("강사id")
  readAt    DateTime? @map("read_at")

  message Message @relation(fields: [messageId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  @@id([userId, messageId])
  @@index([userId], map: "메시지수신_user_idx")
  @@map("메시지 수신자")
}

model MessageAssignment {
  messageId      Int
  unitScheduleId Int
  userId         Int

  message    Message                  @relation(fields: [messageId], references: [id])
  assignment InstructorUnitAssignment @relation(fields: [unitScheduleId, userId], references: [unitScheduleId, userId])

  @@id([messageId, unitScheduleId, userId])
  @@map("메시지_배정")
}

model MessageTemplate {
  key           String   @id @map("템플릿키") // 예: "TEMPORARY", "CONFIRMED_LEADER", "CONFIRMED_MEMBER"
  title         String   @map("제목")
  body          Json     @map("본문") @db.JsonB // Token[] 배열을 JSON으로 저장
  formatPresets Json?    @map("포맷프리셋") @db.JsonB // 포맷 변수별 프리셋 저장
  updatedAt     DateTime @updatedAt @map("수정일시")

  @@map("메시지_템플릿")
}
