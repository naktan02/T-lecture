name: Ping Render Server

on:
  schedule:
    # 13분마다 - Render 서버 깨우기 (무료 티어 슬립 방지)
    # 단, 새벽 2~5시 KST (UTC 17~20시)는 제외
    - cron: '*/9 0-16,21-23 * * *'
  workflow_dispatch:

env:
  SERVER_URL: ${{ secrets.SERVER_URL }}

jobs:
  ping:
    name: Ping Server
    runs-on: ubuntu-latest
    steps:
      - name: Ping server to keep awake
        shell: bash
        run: |
          set -euo pipefail
          code=$(curl -sS --max-time 15 -o /dev/null -w "%{http_code}" "$SERVER_URL/api/v1/batch/ping" || echo "000")
          echo "Response: $code"
          if [ "$code" != "200" ]; then
            echo "Warning: Server responded with $code"
          fi
